{
  "hash": "f704e000486feb6a76ea7a33343859a2",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"08 - Comunicação célula-célula\"\nformat:\n  html:\n    toc: true\ntoc-depth: 3\nexecute:\n  cache: false\n---\n\n\n\n\n\n## Motivação\n\nA comunicação célula-célula (CCC) é um processo fundamental na regulação de funções biológicas em tecidos complexos. Em contextos fisiológicos e patológicos, como no desenvolvimento embrionário, resposta imune e progressão tumoral, as células trocam sinais por meio de interações entre ligantes e receptores. O avanço das tecnologias de transcriptômica de célula única possibilitou a inferência sistemática desses eventos de comunicação, utilizando a expressão gênica como proxy para abundância proteica. Neste tutorial, exploramos o uso da ferramenta LIANA para realizar uma análise robusta e comparativa de interações célula-célula com base em múltiplos métodos e recursos anotados.\n\n## Contextualização\n\nO pacote **LIANA** (Ligand-Receptor Analysis Framework) foi desenvolvido para facilitar essa tarefa ao integrar múltiplos algoritmos e recursos de interações ligante-receptor de forma padronizada. Com suporte nativo a objetos `Seurat` e `SingleCellExperiment`, LIANA permite a execução de métodos consagrados como CellPhoneDB, NATMI, Connectome, logFC, entre outros, utilizando bases como OmniPath, CellChatDB e Consensus. Além disso, oferece funções para agregação de resultados e geração de scores de consenso, promovendo maior robustez e confiança na inferência de eventos de comunicação celular.\n\n## Ajustar ambiente e carregar pacotes\n\nNesta seção, vamos configurar o ambiente de trabalho e carregar os pacotes necessários. Isso inclui verificar e instalar o pacote `liana`, além de carregar bibliotecas como `Seurat`, `tidyverse` e `magrittr`, que serão utilizadas em todas as etapas subsequentes da análise.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Verifica pacotes\nif (!requireNamespace(\"liana\")) {\n  remotes::install_github('saezlab/liana')\n}\n\n# Carregar pacotes\nlibrary(Seurat)\nlibrary(SeuratWrappers)\nlibrary(tidyverse)\nlibrary(magrittr)\nlibrary(liana)\n\n# Definindo diretório padrão\nknitr::opts_knit$set(\n  root.dir = \"/home/oandrefonseca/Disciplinas/PPGBM0117.2025.1\",\n  verbose = FALSE\n)\n\n# Aumentar o limite de uso de memória\noptions(future.globals.maxSize = 10 * 1024^3) # 10 GB, por exemplo\n```\n:::\n\n\n\n\n\n## Carregando dados do projeto\n\nAgora que o ambiente está configurado, carregamos o objeto `Seurat` que contém os dados de expressão gênica já processados e anotados. O uso de um objeto pronto permite focar diretamente na inferência de comunicação célula-célula, utilizando as anotações de tipos celulares para identificar emissores e receptores em potenciais interações.\n\n\n\n\n\n::: {.cell .column-screen-inset-shaded layout-nrow=\"1\" layout-align=\"center\"}\n\n```{.r .cell-code}\n# Carregando um objeto Seurat já processado (pré-clusterizado)\nseurat_object <- readRDS(file = here::here(\"data/seurat_annotated.RDS\"))\n\n# Verificar os clusters\nDimPlot(\n  seurat_object, \n  group.by = \"manual_annotation\"\n  )\n```\n\n::: {.cell-output-display}\n![](08_cell_communication_files/figure-html/fig-umap-1.png){#fig-umap fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n## Preparando análise de comunicação\n\nCom os dados carregados, damos início à etapa de preparação para a inferência de comunicação célula-célula. Aqui, exploramos os recursos e métodos disponíveis no pacote `liana`, que nos permitirão escolher diferentes bancos de interações e algoritmos para calcular os scores entre pares de tipos celulares.\n\n### LIANA: Recursos\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshow_resources()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Default\"          \"Consensus\"        \"Baccin2019\"       \"CellCall\"        \n [5] \"CellChatDB\"       \"Cellinker\"        \"CellPhoneDB\"      \"CellTalkDB\"      \n [9] \"connectomeDB2020\" \"EMBRACE\"          \"Guide2Pharma\"     \"HPMR\"            \n[13] \"ICELLNET\"         \"iTALK\"            \"Kirouac2010\"      \"LRdb\"            \n[17] \"Ramilowski2015\"   \"OmniPath\"         \"MouseConsensus\"  \n```\n\n\n:::\n:::\n\n\n\n\n\n### LIANA: Métodos\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshow_methods()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"connectome\"      \"logfc\"           \"natmi\"           \"sca\"            \n [5] \"cellphonedb\"     \"cytotalk\"        \"call_squidpy\"    \"call_cellchat\"  \n [9] \"call_connectome\" \"call_sca\"        \"call_italk\"      \"call_natmi\"     \n```\n\n\n:::\n:::\n\n\n\n\n\n## Calculando interações L-R\n\nApós observar que recursos e métodos podemos utilizar, vamos aplicar a função `liana_wrap()` para realizar a inferência das interações ligante-receptor entre os tipos celulares anotados no objeto Seurat. Esta etapa é central para o pipeline, pois gera a matriz de interações com scores específicos por método.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nliana_object <- liana_wrap(\n  seurat_object,\n  idents_col = \"manual_annotation\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nExpression from the `RNA` assay will be used\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRunning LIANA with `manual_annotation` as labels!\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`Idents` were converted to factor\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in exec(output, ...): 3031 genes and/or 0 cells were removed as they\nhad no counts!\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: `invoke()` is deprecated as of rlang 0.4.0.\nPlease use `exec()` or `inject()` instead.\nThis warning is displayed once every 8 hours.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLIANA: LR summary stats calculated!\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNow Running: Natmi\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNow Running: Connectome\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNow Running: Logfc\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNow Running: Sca\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNow Running: Cellphonedb\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: `progress_estimated()` was deprecated in dplyr 1.0.0.\nℹ The deprecated feature was likely used in the liana package.\n  Please report the issue at <https://github.com/saezlab/liana/issues>.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nliana_object %>% \n  dplyr::glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nList of 5\n $ natmi      : tibble [40,173 × 14] (S3: tbl_df/tbl/data.frame)\n  ..$ source          : chr [1:40173] \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" ...\n  .. ..- attr(*, \"levels\")= chr [1:14] \"B cells\" \"CD4+ T cells / TCM-like\" \"CD8+ Cytotoxic T cells\" \"Endothelial Cells\" ...\n  ..$ target          : chr [1:40173] \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" ...\n  .. ..- attr(*, \"levels\")= chr [1:14] \"B cells\" \"CD4+ T cells / TCM-like\" \"CD8+ Cytotoxic T cells\" \"Endothelial Cells\" ...\n  ..$ ligand.complex  : chr [1:40173] \"ADAM10\" \"ADAM10\" \"TNFSF14\" \"HLA-B\" ...\n  ..$ ligand          : chr [1:40173] \"ADAM10\" \"ADAM10\" \"TNFSF14\" \"HLA-B\" ...\n  ..$ receptor.complex: chr [1:40173] \"CD44\" \"NOTCH2\" \"TNFRSF14\" \"CD8A\" ...\n  ..$ receptor        : chr [1:40173] \"CD44\" \"NOTCH2\" \"TNFRSF14\" \"CD8A\" ...\n  ..$ receptor.prop   : num [1:40173] 0.826 0.125 0.229 0.186 0.5 ...\n  ..$ ligand.prop     : num [1:40173] 0.209 0.209 0.16 0.934 0.934 ...\n  ..$ ligand.expr     : num [1:40173] 0.322 0.322 0.236 3.429 3.429 ...\n  ..$ receptor.expr   : num [1:40173] 1.902 0.18 0.32 0.438 0.861 ...\n  ..$ ligand.sum      : num [1:40173] 5.05 5.05 1.6 42.87 42.87 ...\n  ..$ receptor.sum    : num [1:40173] 19.96 3.83 4.49 2.87 5.19 ...\n  ..$ prod_weight     : num [1:40173] 0.6131 0.0579 0.0756 1.5003 2.9517 ...\n  ..$ edge_specificity: num [1:40173] 0.00609 0.00299 0.01056 0.01218 0.01327 ...\n $ connectome : tibble [40,173 × 11] (S3: tbl_df/tbl/data.frame)\n  ..$ source          : chr [1:40173] \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" ...\n  .. ..- attr(*, \"levels\")= chr [1:14] \"B cells\" \"CD4+ T cells / TCM-like\" \"CD8+ Cytotoxic T cells\" \"Endothelial Cells\" ...\n  ..$ target          : chr [1:40173] \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" ...\n  .. ..- attr(*, \"levels\")= chr [1:14] \"B cells\" \"CD4+ T cells / TCM-like\" \"CD8+ Cytotoxic T cells\" \"Endothelial Cells\" ...\n  ..$ ligand.complex  : chr [1:40173] \"ADAM10\" \"ADAM10\" \"TNFSF14\" \"HLA-B\" ...\n  ..$ ligand          : chr [1:40173] \"ADAM10\" \"ADAM10\" \"TNFSF14\" \"HLA-B\" ...\n  ..$ receptor.complex: chr [1:40173] \"CD44\" \"NOTCH2\" \"TNFRSF14\" \"CD8A\" ...\n  ..$ receptor        : chr [1:40173] \"CD44\" \"NOTCH2\" \"TNFRSF14\" \"CD8A\" ...\n  ..$ receptor.prop   : num [1:40173] 0.826 0.125 0.229 0.186 0.5 ...\n  ..$ ligand.prop     : num [1:40173] 0.209 0.209 0.16 0.934 0.934 ...\n  ..$ ligand.scaled   : num [1:40173] -0.0184 -0.0184 0.1631 -0.0692 -0.0692 ...\n  ..$ receptor.scaled : num [1:40173] 0.2218 -0.1304 -0.0908 -0.0816 0.1269 ...\n  ..$ weight_sc       : num [1:40173] 0.1017 -0.0744 0.0362 -0.0754 0.0289 ...\n $ logfc      : tibble [40,173 × 11] (S3: tbl_df/tbl/data.frame)\n  ..$ source          : chr [1:40173] \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" ...\n  .. ..- attr(*, \"levels\")= chr [1:14] \"B cells\" \"CD4+ T cells / TCM-like\" \"CD8+ Cytotoxic T cells\" \"Endothelial Cells\" ...\n  ..$ target          : chr [1:40173] \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" ...\n  .. ..- attr(*, \"levels\")= chr [1:14] \"B cells\" \"CD4+ T cells / TCM-like\" \"CD8+ Cytotoxic T cells\" \"Endothelial Cells\" ...\n  ..$ ligand.complex  : chr [1:40173] \"ADAM10\" \"ADAM10\" \"TNFSF14\" \"HLA-B\" ...\n  ..$ ligand          : chr [1:40173] \"ADAM10\" \"ADAM10\" \"TNFSF14\" \"HLA-B\" ...\n  ..$ receptor.complex: chr [1:40173] \"CD44\" \"NOTCH2\" \"TNFRSF14\" \"CD8A\" ...\n  ..$ receptor        : chr [1:40173] \"CD44\" \"NOTCH2\" \"TNFRSF14\" \"CD8A\" ...\n  ..$ receptor.prop   : num [1:40173] 0.826 0.125 0.229 0.186 0.5 ...\n  ..$ ligand.prop     : num [1:40173] 0.209 0.209 0.16 0.934 0.934 ...\n  ..$ ligand.log2FC   : num [1:40173] 0.237 0.237 0.208 -0.218 -0.218 ...\n  ..$ receptor.log2FC : num [1:40173] 0.5184 -0.0712 -0.0385 -0.3203 0.0845 ...\n  ..$ logfc_comb      : num [1:40173] 0.3776 0.0828 0.0848 -0.2693 -0.0669 ...\n $ sca        : tibble [40,173 × 12] (S3: tbl_df/tbl/data.frame)\n  ..$ source          : chr [1:40173] \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" ...\n  .. ..- attr(*, \"levels\")= chr [1:14] \"B cells\" \"CD4+ T cells / TCM-like\" \"CD8+ Cytotoxic T cells\" \"Endothelial Cells\" ...\n  ..$ target          : chr [1:40173] \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" ...\n  .. ..- attr(*, \"levels\")= chr [1:14] \"B cells\" \"CD4+ T cells / TCM-like\" \"CD8+ Cytotoxic T cells\" \"Endothelial Cells\" ...\n  ..$ ligand.complex  : chr [1:40173] \"ADAM10\" \"ADAM10\" \"TNFSF14\" \"HLA-B\" ...\n  ..$ ligand          : chr [1:40173] \"ADAM10\" \"ADAM10\" \"TNFSF14\" \"HLA-B\" ...\n  ..$ receptor.complex: chr [1:40173] \"CD44\" \"NOTCH2\" \"TNFRSF14\" \"CD8A\" ...\n  ..$ receptor        : chr [1:40173] \"CD44\" \"NOTCH2\" \"TNFRSF14\" \"CD8A\" ...\n  ..$ receptor.prop   : num [1:40173] 0.826 0.125 0.229 0.186 0.5 ...\n  ..$ ligand.prop     : num [1:40173] 0.209 0.209 0.16 0.934 0.934 ...\n  ..$ ligand.expr     : num [1:40173] 0.322 0.322 0.236 3.429 3.429 ...\n  ..$ receptor.expr   : num [1:40173] 1.902 0.18 0.32 0.438 0.861 ...\n  ..$ global_mean     : num [1:40173] 0.0741 0.0741 0.0741 0.0741 0.0741 ...\n  ..$ LRscore         : num [1:40173] 0.914 0.764 0.788 0.943 0.959 ...\n $ cellphonedb: tibble [40,173 × 12] (S3: tbl_df/tbl/data.frame)\n  ..$ source          : chr [1:40173] \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" ...\n  .. ..- attr(*, \"levels\")= chr [1:14] \"B cells\" \"CD4+ T cells / TCM-like\" \"CD8+ Cytotoxic T cells\" \"Endothelial Cells\" ...\n  ..$ target          : chr [1:40173] \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" \"CD4+ T cells / TCM-like\" ...\n  .. ..- attr(*, \"levels\")= chr [1:14] \"B cells\" \"CD4+ T cells / TCM-like\" \"CD8+ Cytotoxic T cells\" \"Endothelial Cells\" ...\n  ..$ ligand.complex  : chr [1:40173] \"ADAM10\" \"ADAM10\" \"TNFSF14\" \"HLA-B\" ...\n  ..$ ligand          : chr [1:40173] \"ADAM10\" \"ADAM10\" \"TNFSF14\" \"HLA-B\" ...\n  ..$ receptor.complex: chr [1:40173] \"CD44\" \"NOTCH2\" \"TNFRSF14\" \"CD8A\" ...\n  ..$ receptor        : chr [1:40173] \"CD44\" \"NOTCH2\" \"TNFRSF14\" \"CD8A\" ...\n  ..$ receptor.prop   : num [1:40173] 0.826 0.125 0.229 0.186 0.5 ...\n  ..$ ligand.prop     : num [1:40173] 0.209 0.209 0.16 0.934 0.934 ...\n  ..$ ligand.expr     : num [1:40173] 0.322 0.322 0.236 3.429 3.429 ...\n  ..$ receptor.expr   : num [1:40173] 1.902 0.18 0.32 0.438 0.861 ...\n  ..$ lr.mean         : num [1:40173] 1.112 0.251 0.278 1.933 2.145 ...\n  ..$ pvalue          : num [1:40173] 0 1 0 1 0 0.017 1 1 1 1 ...\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## Agregando resultados\n\nOs resultados de múltiplos métodos podem variar. Para obter maior robustez, agregamos os resultados por meio de um rank de **consenso** utilizando `liana_aggregate()`. Essa abordagem permite priorizar interações que são consistentemente bem ranqueadas entre os diferentes algoritmos aplicados.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nliana_object <- liana_object %>%\n  liana_aggregate()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNow aggregating natmi\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNow aggregating connectome\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNow aggregating logfc\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNow aggregating sca\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNow aggregating cellphonedb\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nAggregating Ranks\n```\n\n\n:::\n:::\n\n\n\n\n\n## Visualizar conexões\n\nCom os resultados agregados, passamos à etapa de visualização. Utilizamos a função `liana_dotplot()` para representar graficamente as interações priorizadas entre tipos celulares emissores e receptores. Esse tipo de plotagem facilita a interpretação das principais vias de sinalização inferidas no sistema biológico estudado.\n\n\n\n\n\n::: {.cell .column-screen-inset-shaded layout-nrow=\"1\" layout-align=\"center\"}\n\n```{.r .cell-code}\nliana_object %>%\n  liana_dotplot(\n    source_groups = c(\"PRAME+ Tumor\"),\n    target_groups = c(\"CD4+ T cells / TCM-like\", \"CD8+ Cytotoxic T cells\", \"B cells\"),\n    ntop = 20)\n```\n\n::: {.cell-output-display}\n![](08_cell_communication_files/figure-html/fig-dotplot-1.png){#fig-dotplot fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n::: {.callout-note}\nCada ponto representa uma interação ligante-receptor priorizada. O eixo Y lista as interações (ligante → receptor) e o eixo X mostra os pares de tipos celulares. O tamanho do ponto indica a especificidade da interação, enquanto a intensidade da cor representa a magnitude do sinal (score de expressão). Interações mais relevantes tendem a ser grandes e escuras.\n:::\n\n## Heatmap com interações por tipo celular\n\nPara uma visão global da frequência de interações entre tipos celulares, geramos um heatmap utilizando apenas interações altamente ranqueadas (`aggregate_rank <= 0.01`). Essa visualização permite identificar padrões gerais de comunicação e potenciais hubs de sinalização no microambiente celular.\n\n\n\n\n\n::: {.cell .column-screen-inset-shaded layout-nrow=\"1\" layout-align=\"center\"}\n\n```{.r .cell-code}\nliana_trunc <- liana_object %>%\n  filter(aggregate_rank <= 0.01)\n\n# Gerando visualização\nheat_freq(liana_trunc)\n```\n\n::: {.cell-output-display}\n![](08_cell_communication_files/figure-html/fig-heatmap-1.png){#fig-heatmap fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n::: {.callout-note}\nNeste gráfico, a intensidade da cor representa o número de interações inferidas entre os tipos celulares do eixo X (emissores) e do eixo Y (receptores). Tons mais escuros indicam maior número de interações inferidas entre os pares. Essa abordagem é útil para destacar populações celulares com papel central na rede de comunicação.\n:::\n\n## Salvando o objeto anotado\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(seurat_object, file = \"data/seurat_annotated.RDS\")\n```\n:::\n",
    "supporting": [
      "08_cell_communication_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}